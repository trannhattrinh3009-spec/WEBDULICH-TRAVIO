<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Ticket & Countdown - Travio</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.1);
            padding: 30px;
            margin-top: 20px;
        }
        
        .ticket-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #eaeaea;
        }
        
        .back-btn {
            background: #1a237e;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 50px;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
        }
        
        .ticket-title {
            font-size: 1.5rem;
            color: #1a237e;
            font-weight: bold;
        }
        
        .booking-ref {
            background: #f0f7ff;
            padding: 10px 15px;
            border-radius: 10px;
            font-family: monospace;
            font-weight: bold;
            color: #1a237e;
        }
        
        .flight-route {
            font-size: 1.8rem;
            font-weight: bold;
            color: #1a237e;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .flight-details {
            display: flex;
            justify-content: space-between;
            background: #f0f7ff;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .detail-item {
            margin: 5px 15px;
        }
        
        .detail-label {
            font-weight: 600;
            color: #555;
            font-size: 0.9rem;
        }
        
        .detail-value {
            font-weight: bold;
            color: #1a237e;
        }
        
        .terminal-info {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid #4caf50;
        }
        
        .flight-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: #1a237e;
        }
        
        .time-info {
            display: flex;
            justify-content: space-around;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .time-box {
            text-align: center;
            padding: 10px;
        }
        
        .time-label {
            font-size: 0.9rem;
            color: #666;
        }
        
        .time-value {
            font-size: 1.3rem;
            font-weight: bold;
            color: #1a237e;
        }
        
        .passenger-info {
            background: #fff3e0;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid #ff9800;
        }
        
        .passenger-name {
            font-size: 1.3rem;
            font-weight: bold;
            color: #1a237e;
        }
        
        .countdown-section {
            text-align: center;
            background: linear-gradient(135deg, #1a237e, #3949ab);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin: 30px 0;
        }
        
        .countdown-title {
            font-size: 1.2rem;
            margin-bottom: 20px;
        }
        
        .countdown-timer {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .countdown-unit {
            text-align: center;
            background: rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 10px;
            min-width: 80px;
        }
        
        .countdown-number {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 5px;
            font-variant-numeric: tabular-nums;
        }
        
        .countdown-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .section-title {
            font-size: 1.5rem;
            color: #1a237e;
            margin: 30px 0 20px 0;
            padding-bottom: 10px;
            border-bottom: 2px solid #eaeaea;
        }
        
        .deals-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }
        
        .deals-table th {
            background: #1a237e;
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: 600;
        }
        
        .deals-table td {
            padding: 15px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }
        
        .deals-table tr:nth-child(even) {
            background: #f9f9f9;
        }
        
        .deals-table tr:hover {
            background: #f0f7ff;
        }
        
        .price-tag {
            background: #4caf50;
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .newsletter-section {
            background: linear-gradient(135deg, #ff9800, #ff5722);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin: 30px 0;
        }
        
        .newsletter-title {
            font-size: 1.5rem;
            margin-bottom: 15px;
        }
        
        .newsletter-form {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .email-input {
            padding: 12px 20px;
            border: none;
            border-radius: 50px;
            width: 300px;
            font-size: 1rem;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }
        
        .subscribe-btn {
            background: #1a237e;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            transition: background 0.3s;
        }
        
        .subscribe-btn:hover {
            background: #3949ab;
        }
        
        .footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #eaeaea;
            color: #666;
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        .no-booking {
            text-align: center;
            padding: 50px;
            background: #fff3e0;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .no-booking h2 {
            color: #ff9800;
            margin-bottom: 20px;
        }
        
        @media (max-width: 768px) {
            .ticket-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .flight-details, .time-info, .countdown-timer, .newsletter-form {
                flex-direction: column;
                align-items: center;
            }
            
            .deals-table {
                font-size: 0.9rem;
                display: block;
                overflow-x: auto;
            }
            
            .email-input {
                width: 100%;
                max-width: 300px;
            }
        }
        
        .blink {
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .qr-code {
            text-align: center;
            margin: 20px 0;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 10px;
        }
        
        .qr-placeholder {
            width: 150px;
            height: 150px;
            background: #ddd;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            color: #666;
        }
    .stepper-container {
            background: linear-gradient(135deg, #1a237e, #3949ab);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .stepper {
            display: flex;
            justify-content: center;
            position: relative;
            margin-bottom: 0;
        }

        .stepper::before {
            content: '';
            position: absolute;
            top: 24px;
            left: 15%;
            width: 70%;
            height: 3px;
            background-color: rgba(255,255,255,0.3);
            z-index: 1;
        }

        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 2;
            position: relative;
            width: 120px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .step:hover .step-circle {
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(255,255,255,0.5);
        }

        .step-circle {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: rgba(255,255,255,0.2);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 10px;
            border: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .step.active .step-circle {
            background-color: #ff9800;
            border-color: white;
            box-shadow: 0 0 15px rgba(255,152,0,0.7);
        }

        .step.completed .step-circle {
            background-color: #4caf50;
        }

        .step.completed .step-circle::after {
            content: '✓';
            font-size: 1.8rem;
        }

        .step-label {
            color: white;
            font-weight: 500;
            text-align: center;
            font-size: 0.9rem;
        }

        .step.active .step-label {
            color: #ff9800;
            font-weight: 600;
        }

        /* NỘI DUNG CÁC BƯỚC */
        .step-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .step-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* BƯỚC 1: TÌM CHUYẾN BAY */
        .flight-search-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-top: 20px;
        }

        .search-form {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
            font-size: 0.9rem;
        }

        .form-control {
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1rem;
            transition: border 0.3s ease;
        }

        .form-control:focus {
            border-color: #1a237e;
            outline: none;
            box-shadow: 0 0 0 3px rgba(26, 35, 126, 0.2);
        }

        .search-btn {
            grid-column: 1 / -1;
            background: linear-gradient(to right, #ff9800, #ff5722);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .search-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 15px rgba(255, 87, 34, 0.4);
        }

        /* KẾT QUẢ TÌM KIẾM */
        .flight-results {
            margin-top: 30px;
        }

        .flight-card {
            border: 1px solid #ddd;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .flight-card:hover {
            border-color: #ff9800;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .flight-info {
            flex: 1;
        }

        .flight-route-display {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .city {
            font-size: 1.3rem;
            font-weight: bold;
            color: #1a237e;
        }

        .flight-icon {
            margin: 0 15px;
            color: #ff9800;
            font-size: 1.3rem;
        }

        .flight-details-small {
            display: flex;
            gap: 15px;
            color: #666;
            font-size: 0.9rem;
        }

        .flight-price {
            font-size: 1.5rem;
            font-weight: bold;
            color: #ff5722;
        }

        .select-flight-btn {
            background-color: #1a237e;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .select-flight-btn:hover {
            background-color: #283593;
            transform: scale(1.05);
        }

        /* NÚT ĐIỀU HƯỚNG */
        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        .nav-btn {
            padding: 12px 30px;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
        }

        .btn-back {
            background-color: #f5f5f5;
            color: #333;
            border: 1px solid #ddd;
        }

        .btn-back:hover {
            background-color: #e0e0e0;
        }

        .btn-next {
            background: linear-gradient(to right, #1a237e, #3949ab);
            color: white;
        }

        .btn-next:hover {
            background: linear-gradient(to right, #283593, #4a5fc1);
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(26, 35, 126, 0.3);
        }

        /* BƯỚC 2: THÔNG TIN HÀNH KHÁCH */
        .passenger-form {
            max-width: 800px;
            margin: 0 auto;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }

        /* BƯỚC 3: XÁC NHẬN */
        .confirmation-details {
            max-width: 800px;
            margin: 0 auto;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 15px 0;
            border-bottom: 1px solid #eee;
        }

        .detail-label {
            font-weight: 600;
            color: #555;
        }

        .detail-value {
            color: #333;
        }

        .total-price {
            font-size: 1.8rem;
            color: #ff5722;
            font-weight: bold;
            text-align: right;
            margin-top: 20px;
        }

        /* THÊM CSS CHO VALIDATION */
        .error-message {
            color: #f44336;
            font-size: 0.85rem;
            margin-top: 5px;
            display: none;
        }
        
        .form-control.error {
            border-color: #f44336;
            background-color: #ffebee;
        }
        
        .form-control.valid {
            border-color: #4caf50;
            background-color: #e8f5e9;
        }
        
        .validation-icon {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            display: none;
            color: #4caf50;
            font-size: 1.2rem;
        }
        
        .form-group {
            position: relative;
        }
        
        /* PHƯƠNG THỨC THANH TOÁN */
        .payment-methods {
            margin: 25px 0;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 10px;
        }
        
        .payment-title {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: #1a237e;
            font-weight: 600;
        }
        
        .payment-options {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .payment-option {
            flex: 1;
            min-width: 150px;
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .payment-option:hover {
            border-color: #1a237e;
            background-color: #f0f7ff;
        }
        
        .payment-option.selected {
            border-color: #4caf50;
            background-color: #e8f5e9;
            box-shadow: 0 0 10px rgba(76, 175, 80, 0.3);
        }
        
        .payment-icon {
            font-size: 2rem;
            margin-bottom: 10px;
            color: #1a237e;
        }
        
        .payment-name {
            font-weight: 600;
            color: #333;
        }
        
        .payment-fee {
            font-size: 0.85rem;
            color: #666;
            margin-top: 5px;
        }
        
        /* THẺ TÍN DỤNG FORM */
        .credit-card-form {
            margin-top: 20px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            border: 1px solid #ddd;
            display: none;
        }
        
        .credit-card-form.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        .card-input-group {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .card-input-full {
            grid-column: 1 / -1;
        }
        
        .card-preview {
            background: linear-gradient(135deg, #1a237e, #3949ab);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-family: monospace;
        }
        
        .card-number {
            font-size: 1.3rem;
            letter-spacing: 2px;
            margin-bottom: 15px;
        }
        
        .card-details {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
        }
        
        /* QR CODE SECTION */
        .qr-section {
            text-align: center;
            margin: 25px 0;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa, #e4e8f0);
            border-radius: 10px;
        }
        
        .qr-title {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: #1a237e;
            font-weight: 600;
        }
        
        .qr-instruction {
            color: #666;
            margin-bottom: 15px;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .qr-code-img {
            width: 180px;
            height: 180px;
            margin: 0 auto 15px;
            background: white;
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            color: #666;
        }
        
        .qr-code-placeholder {
            width: 100%;
            height: 100%;
            background: 
                linear-gradient(45deg, #ddd 25%, transparent 25%),
                linear-gradient(-45deg, #ddd 25%, transparent 25%),
                linear-gradient(45deg, transparent 75%, #ddd 75%),
                linear-gradient(-45deg, transparent 75%, #ddd 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }
        
        .qr-text {
            font-size: 0.9rem;
            color: #666;
            margin-top: 10px;
        }
        
        .bank-info {
            margin-top: 15px;
            padding: 15px;
            background: #e8f5e9;
            border-radius: 10px;
            border-left: 4px solid #4caf50;
        }
        
        .bank-details {
            text-align: left;
            max-width: 500px;
            margin: 0 auto;
        }
        
        /* RESPONSIVE */
        @media (max-width: 768px) {
            .search-form {
                grid-template-columns: 1fr;
            }
            
            .flight-card {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .flight-route-display {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
            
            .flight-icon {
                transform: rotate(90deg);
                margin: 5px 0;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .stepper::before {
                display: none;
            }
            
            .step {
                width: 100px;
            }
            
            .payment-options {
                flex-direction: column;
            }
            
            .card-input-group {
                grid-template-columns: 1fr;
            }
            
            .qr-code-img {
                width: 150px;
                height: 150px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="ticket-header">
            <a href="#" class="back-btn" id="backToHome">← Trang chủ</a>
            <div class="ticket-title">Đặt vé máy bay - Travio</div>
            <div class="booking-ref" id="bookingRef">Bước 1/3</div>
        </div>
        
        <!-- THÊM PHẦN STEPPER -->
        <div class="stepper-container">
            <div class="stepper">
                <div class="step active" id="step1">
                    <div class="step-circle">1</div>
                    <div class="step-label">Chọn chuyến bay</div>
                </div>
                <div class="step" id="step2">
                    <div class="step-circle">2</div>
                    <div class="step-label">Nhập thông tin</div>
                </div>
                <div class="step" id="step3">
                    <div class="step-circle">3</div>
                    <div class="step-label">Xác nhận & Thanh toán</div>
                </div>
            </div>
        </div>
        
        <!-- NỘI DUNG BƯỚC 1: CHỌN CHUYẾN BAY -->
        <div class="step-content active" id="step1-content">
            <div class="flight-search-container">
                <h2 style="color: #1a237e; margin-bottom: 25px;">Tìm chuyến bay</h2>
                
                <div class="search-form">
                    <div class="form-group">
                        <label for="departure">Điểm đi</label>
                        <select id="departure" class="form-control">
                            <option value="">Chọn điểm đi</option>
                            <option value="SGN" selected>TP. Hồ Chí Minh (SGN)</option>
                            <option value="HAN">Hà Nội (HAN)</option>
                            <option value="DAD">Đà Nẵng (DAD)</option>
                            <option value="PQC">Phú Quốc (PQC)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="arrival">Điểm đến</label>
                        <select id="arrival" class="form-control">
                            <option value="">Chọn điểm đến</option>
                            <option value="BKK" selected>Bangkok (BKK)</option>
                            <option value="SIN">Singapore (SIN)</option>
                            <option value="KUL">Kuala Lumpur (KUL)</option>
                            <option value="HKG">Hong Kong (HKG)</option>
                            <option value="TPE">Taipei (TPE)</option>
                            <option value="NRT">Tokyo (NRT)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="departureDate">Ngày đi</label>
                        <input type="date" id="departureDate" class="form-control" value="2026-01-19">
                    </div>
                    
                    <div class="form-group">
                        <label for="passengers">Hành khách</label>
                        <select id="passengers" class="form-control">
                            <option value="1">1 hành khách</option>
                            <option value="2">2 hành khách</option>
                            <option value="3">3 hành khách</option>
                            <option value="4">4 hành khách</option>
                        </select>
                    </div>
                    
                    <button class="search-btn" id="searchFlights">
                        <i class="fas fa-search"></i> Tìm chuyến bay
                    </button>
                </div>
                
                <div class="flight-results" id="flightResults">
                    <!-- Kết quả tìm kiếm sẽ hiển thị ở đây -->
                    <div class="flight-card">
                        <div class="flight-info">
                            <div class="flight-route-display">
                                <span class="city">SGN</span>
                                <span class="flight-icon">→</span>
                                <span class="city">BKK</span>
                            </div>
                            <div class="flight-details-small">
                                <span><i class="far fa-calendar"></i> 19/01/2026</span>
                                <span><i class="far fa-clock"></i> 09:05 - 11:30</span>
                                <span><i class="fas fa-plane"></i> Bamboo Airways</span>
                                <span><i class="fas fa-chair"></i> Thương gia</span>
                            </div>
                        </div>
                        <div class="flight-price">5.280.000₫</div>
                        <button class="select-flight-btn" data-flight="BB123">
                            Chọn
                        </button>
                    </div>
                    
                    <div class="flight-card">
                        <div class="flight-info">
                            <div class="flight-route-display">
                                <span class="city">SGN</span>
                                <span class="flight-icon">→</span>
                                <span class="city">BKK</span>
                            </div>
                            <div class="flight-details-small">
                                <span><i class="far fa-calendar"></i> 19/01/2026</span>
                                <span><i class="far fa-clock"></i> 14:20 - 16:45</span>
                                <span><i class="fas fa-plane"></i> Vietnam Airlines</span>
                                <span><i class="fas fa-chair"></i> Thương gia</span>
                            </div>
                        </div>
                        <div class="flight-price">5.850.000₫</div>
                        <button class="select-flight-btn" data-flight="VN567">
                            Chọn
                        </button>
                    </div>
                    
                    <div class="flight-card">
                        <div class="flight-info">
                            <div class="flight-route-display">
                                <span class="city">SGN</span>
                                <span class="flight-icon">→</span>
                                <span class="city">BKK</span>
                            </div>
                            <div class="flight-details-small">
                                <span><i class="far fa-calendar"></i> 19/01/2026</span>
                                <span><i class="far fa-clock"></i> 18:40 - 21:05</span>
                                <span><i class="fas fa-plane"></i> Thai Airways</span>
                                <span><i class="fas fa-chair"></i> Thương gia</span>
                            </div>
                        </div>
                        <div class="flight-price">6.120.000₫</div>
                        <button class="select-flight-btn" data-flight="TG789">
                            Chọn
                        </button>
                    </div>
                </div>
                
                <div class="navigation-buttons">
                    <button class="nav-btn btn-back" disabled>
                        ← Quay lại
                    </button>
                    <button class="nav-btn btn-next" id="nextToStep2" disabled>
                        Tiếp theo →
                    </button>
                </div>
            </div>
        </div>
        
        <!-- NỘI DUNG BƯỚC 2: NHẬP THÔNG TIN -->
        <div class="step-content" id="step2-content">
            <div class="flight-search-container">
                <h2 style="color: #1a237e; margin-bottom: 25px;">Thông tin hành khách</h2>
                
                <div class="passenger-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="firstName">Họ và tên đệm *</label>
                            <input type="text" id="firstName" class="form-control" placeholder="Nguyễn Văn">
                            <div class="error-message" id="firstNameError">Vui lòng nhập họ và tên đệm</div>
                            <span class="validation-icon" id="firstNameIcon"><i class="fas fa-check-circle"></i></span>
                        </div>
                        <div class="form-group">
                            <label for="lastName">Tên *</label>
                            <input type="text" id="lastName" class="form-control" placeholder="An">
                            <div class="error-message" id="lastNameError">Vui lòng nhập tên</div>
                            <span class="validation-icon" id="lastNameIcon"><i class="fas fa-check-circle"></i></span>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="email">Email *</label>
                            <input type="email" id="email" class="form-control" placeholder="nguyenvanan@example.com">
                            <div class="error-message" id="emailError">Vui lòng nhập email hợp lệ (ví dụ: name@example.com)</div>
                            <span class="validation-icon" id="emailIcon"><i class="fas fa-check-circle"></i></span>
                        </div>
                        <div class="form-group">
                            <label for="phone">Số điện thoại *</label>
                            <input type="tel" id="phone" class="form-control" placeholder="0912 345 678">
                            <div class="error-message" id="phoneError">Vui lòng nhập số điện thoại hợp lệ (10-11 chữ số)</div>
                            <span class="validation-icon" id="phoneIcon"><i class="fas fa-check-circle"></i></span>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="flightClass">Hạng vé</label>
                        <select id="flightClass" class="form-control">
                            <option value="economy">Hạng Phổ Thông</option>
                            <option value="business" selected>Hạng Thương Gia</option>
                            <option value="first">Hạng Nhất</option>
                        </select>
                    </div>
                </div>
                
                <div class="navigation-buttons">
                    <button class="nav-btn btn-back" id="backToStep1">
                        ← Quay lại
                    </button>
                    <button class="nav-btn btn-next" id="nextToStep3">
                        Tiếp theo →
                    </button>
                </div>
            </div>
        </div>
        
        <!-- NỘI DUNG BƯỚC 3: XÁC NHẬN & THANH TOÁN -->
        <div class="step-content" id="step3-content">
            <div class="flight-search-container">
                <h2 style="color: #1a237e; margin-bottom: 25px;">Xác nhận đặt vé & Thanh toán</h2>
                
                <div class="confirmation-details">
                    <div class="detail-row">
                        <span class="detail-label">Chuyến bay:</span>
                        <span class="detail-value" id="confirmRoute">SGN → BKK</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Ngày khởi hành:</span>
                        <span class="detail-value" id="confirmDate">19/01/2026</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Số hành khách:</span>
                        <span class="detail-value" id="confirmPassengers">1 hành khách</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Hạng vé:</span>
                        <span class="detail-value" id="confirmClass">Hạng Thương Gia</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Họ và tên:</span>
                        <span class="detail-value" id="confirmName">-</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Email:</span>
                        <span class="detail-value" id="confirmEmail">-</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Số điện thoại:</span>
                        <span class="detail-value" id="confirmPhone">-</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Mã chuyến bay:</span>
                        <span class="detail-value" id="confirmFlightCode">-</span>
                    </div>
                    
                    <div class="total-price" id="confirmPrice">0₫</div>
                </div>
                
                <!-- PHẦN QR CODE THANH TOÁN -->
                <div class="qr-section">
                    <div class="qr-title">Quét mã QR để thanh toán</div>
                    <p class="qr-instruction">Sử dụng ứng dụng ngân hàng trên điện thoại để quét mã QR bên dưới và hoàn tất thanh toán.</p>
                    
                    <div class="qr-code-img">
                        <div class="qr-code-placeholder">
                            <div>MÃ QR THANH TOÁN</div>
                            <div style="font-size: 0.7rem; margin-top: 5px;">TRAVIO-AIR-2026</div>
                        </div>
                    </div>
                    
                    <div class="qr-text">
                        Mã giao dịch: <strong>TRAVIO-<span id="transactionCode">000000</span></strong><br>
                        Hạn thanh toán: <strong id="paymentExpiry">30 phút</strong>
                    </div>
                    
                    <div class="bank-info">
                        <div class="bank-details">
                            <div><strong>Thông tin chuyển khoản:</strong></div>
                            <div>Số tài khoản: <strong>123456789</strong></div>
                            <div>Chủ tài khoản: <strong>CÔNG TY TNHH TRAVIO</strong></div>
                            <div>Ngân hàng: <strong>Vietcombank - Chi nhánh TP.HCM</strong></div>
                            <div>Nội dung: <strong>TRAVIO <span id="bookingCodeDisplay">BB123</span> <span id="customerPhoneDisplay">0912345678</span></strong></div>
                        </div>
                    </div>
                </div>
                
                <!-- PHẦN PHƯƠNG THỨC THANH TOÁN -->
                <div class="payment-methods">
                    <div class="payment-title">Chọn phương thức thanh toán</div>
                    <div class="payment-options">
                        <div class="payment-option" data-method="qr" id="paymentQR">
                            <div class="payment-icon"><i class="fas fa-qrcode"></i></div>
                            <div class="payment-name">QR Code</div>
                            <div class="payment-fee">Miễn phí</div>
                        </div>
                        
                        <div class="payment-option" data-method="visa" id="paymentVisa">
                            <div class="payment-icon"><i class="fab fa-cc-visa"></i></div>
                            <div class="payment-name">Thẻ Visa/MasterCard</div>
                            <div class="payment-fee">Phí 1.5%</div>
                        </div>
                        
                        <div class="payment-option" data-method="momo" id="paymentMomo">
                            <div class="payment-icon"><i class="fas fa-mobile-alt"></i></div>
                            <div class="payment-name">Ví MoMo</div>
                            <div class="payment-fee">Miễn phí</div>
                        </div>
                        
                        <div class="payment-option" data-method="bank" id="paymentBank">
                            <div class="payment-icon"><i class="fas fa-university"></i></div>
                            <div class="payment-name">Chuyển khoản</div>
                            <div class="payment-fee">Miễn phí</div>
                        </div>
                    </div>
                    
                    <!-- FORM THẺ TÍN DỤNG -->
                    <div class="credit-card-form" id="creditCardForm">
                        <div class="card-preview">
                            <div class="card-number">**** **** **** <span id="cardLastFour">1234</span></div>
                            <div class="card-details">
                                <div>
                                    <div>CHỦ THẺ</div>
                                    <div id="cardHolderName">NGUYEN VAN A</div>
                                </div>
                                <div>
                                    <div>HẠN THẺ</div>
                                    <div id="cardExpiry">12/26</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card-input-group">
                            <div class="form-group card-input-full">
                                <label for="cardNumber">Số thẻ *</label>
                                <input type="text" id="cardNumber" class="form-control" placeholder="1234 5678 9012 3456" maxlength="19">
                                <div class="error-message" id="cardNumberError">Vui lòng nhập số thẻ hợp lệ (16 chữ số)</div>
                            </div>
                            
                            <div class="form-group">
                                <label for="cardHolder">Tên chủ thẻ *</label>
                                <input type="text" id="cardHolder" class="form-control" placeholder="NGUYEN VAN A">
                                <div class="error-message" id="cardHolderError">Vui lòng nhập tên chủ thẻ</div>
                            </div>
                            
                            <div class="form-group">
                                <label for="cardExpiryDate">Ngày hết hạn *</label>
                                <input type="text" id="cardExpiryDate" class="form-control" placeholder="MM/YY" maxlength="5">
                                <div class="error-message" id="cardExpiryError">Vui lòng nhập ngày hết hạn (MM/YY)</div>
                            </div>
                            
                            <div class="form-group">
                                <label for="cardCVV">Mã CVV *</label>
                                <input type="password" id="cardCVV" class="form-control" placeholder="123" maxlength="3">
                                <div class="error-message" id="cardCVVError">Vui lòng nhập mã CVV (3 chữ số)</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- THÔNG TIN THANH TOÁN -->
                <div class="confirmation-details" style="margin-top: 20px;">
                    <div class="detail-row">
                        <span class="detail-label">Giá vé:</span>
                        <span class="detail-value" id="ticketPrice">0₫</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phí dịch vụ:</span>
                        <span class="detail-value" id="serviceFee">0₫</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phí thanh toán:</span>
                        <span class="detail-value" id="paymentFee">0₫</span>
                    </div>
                    <div class="detail-row" style="border-top: 2px solid #1a237e; padding-top: 20px; font-size: 1.1rem;">
                        <span class="detail-label" style="font-weight: 700;">Tổng thanh toán:</span>
                        <span class="detail-value" id="totalPayment" style="color: #ff5722; font-weight: 700; font-size: 1.3rem;">0₫</span>
                    </div>
                </div>
                
                <div class="navigation-buttons">
                    <button class="nav-btn btn-back" id="backToStep2">
                        ← Quay lại
                    </button>
                    <button class="nav-btn btn-next" id="confirmBooking" style="background: linear-gradient(to right, #4caf50, #2e7d32);">
                        <i class="fas fa-lock"></i> Thanh toán & Xác nhận
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // KHỞI TẠO STATE
        let currentStep = 1;
        let selectedFlight = null;
        let selectedPaymentMethod = 'qr'; // Mặc định là QR Code
        let bookingData = {
            departure: 'SGN',
            arrival: 'BKK',
            departureDate: '2026-01-19',
            passengers: 1,
            flightClass: 'business',
            flightCode: '',
            price: 0,
            firstName: '',
            lastName: '',
            email: '',
            phone: '',
            fullName: '',
            paymentMethod: 'qr',
            cardInfo: null
        };

        // HÀM KIỂM TRA EMAIL
        function validateEmail(email) {
            const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
            return emailRegex.test(email);
        }

        // HÀM KIỂM TRA SỐ ĐIỆN THOẠI VIỆT NAM
        function validatePhone(phone) {
            const cleanPhone = phone.replace(/[\s\-\(\)\.]+/g, '');
            const phoneRegex = /^(0[3|5|7|8|9])[0-9]{8}$/;
            const intlPhoneRegex = /^(\+84|84)[3|5|7|8|9][0-9]{8}$/;
            return phoneRegex.test(cleanPhone) || intlPhoneRegex.test(cleanPhone);
        }

        // HÀM KIỂM TRA TÊN
        function validateName(name) {
            return name.trim().length > 0;
        }

        // HÀM KIỂM TRA THẺ TÍN DỤNG
        function validateCardNumber(cardNumber) {
            const cleanCard = cardNumber.replace(/\s/g, '');
            return /^\d{16}$/.test(cleanCard);
        }

        function validateCardExpiry(expiry) {
            return /^(0[1-9]|1[0-2])\/([0-9]{2})$/.test(expiry);
        }

        function validateCVV(cvv) {
            return /^\d{3}$/.test(cvv);
        }

        // HÀM HIỂN THỊ LỖI
        function showError(inputId, errorId, iconId, message) {
            const input = document.getElementById(inputId);
            if (input) {
                input.classList.add('error');
                input.classList.remove('valid');
            }
            const error = document.getElementById(errorId);
            if (error) {
                error.textContent = message;
                error.style.display = 'block';
            }
            const icon = document.getElementById(iconId);
            if (icon) icon.style.display = 'none';
        }

        // HÀM HIỂN THỊ HỢP LỆ
        function showValid(inputId, errorId, iconId) {
            const input = document.getElementById(inputId);
            if (input) {
                input.classList.remove('error');
                input.classList.add('valid');
            }
            const error = document.getElementById(errorId);
            if (error) error.style.display = 'none';
            const icon = document.getElementById(iconId);
            if (icon) icon.style.display = 'block';
        }

        // HÀM XÓA VALIDATION
        function clearValidation(inputId, errorId, iconId) {
            const input = document.getElementById(inputId);
            if (input) input.classList.remove('error', 'valid');
            const error = document.getElementById(errorId);
            if (error) error.style.display = 'none';
            const icon = document.getElementById(iconId);
            if (icon) icon.style.display = 'none';
        }

        // HÀM CHUYỂN BƯỚC
        function goToStep(step) {
            document.querySelectorAll('.step-content').forEach(content => {
                content.classList.remove('active');
            });
            
            document.querySelectorAll('.step').forEach(stepEl => {
                stepEl.classList.remove('active');
                stepEl.classList.remove('completed');
            });
            
            for (let i = 1; i < step; i++) {
                const stepEl = document.getElementById(`step${i}`);
                if (stepEl) stepEl.classList.add('completed');
            }
            
            const currentStepEl = document.getElementById(`step${step}`);
            if (currentStepEl) currentStepEl.classList.add('active');
            
            const currentContent = document.getElementById(`step${step}-content`);
            if (currentContent) currentContent.classList.add('active');
            
            currentStep = step;
            const bookingRef = document.getElementById('bookingRef');
            if (bookingRef) bookingRef.textContent = `Bước ${step}/3`;
            
            if (step === 1) {
                updateStep1Buttons();
            } else if (step === 3) {
                updatePaymentInfo();
                updateTransactionCode();
            }
        }

        // CẬP NHẬT NÚT Ở BƯỚC 1
        function updateStep1Buttons() {
            const nextBtn = document.getElementById('nextToStep2');
            if (nextBtn) {
                if (selectedFlight) {
                    nextBtn.disabled = false;
                    nextBtn.style.opacity = '1';
                    nextBtn.style.cursor = 'pointer';
                } else {
                    nextBtn.disabled = true;
                    nextBtn.style.opacity = '0.5';
                    nextBtn.style.cursor = 'not-allowed';
                }
            }
        }

        // CẬP NHẬT THÔNG TIN THANH TOÁN
        function updatePaymentInfo() {
            const ticketPrice = bookingData.price || 0;
            const serviceFee = Math.round(ticketPrice * 0.02); // 2% phí dịch vụ
            
            let paymentFee = 0;
            if (selectedPaymentMethod === 'visa') {
                paymentFee = Math.round(ticketPrice * 0.015); // 1.5% phí thẻ
            }
            
            const totalPayment = ticketPrice + serviceFee + paymentFee;
            
            // Cập nhật DOM
            const ticketPriceEl = document.getElementById('ticketPrice');
            const serviceFeeEl = document.getElementById('serviceFee');
            const paymentFeeEl = document.getElementById('paymentFee');
            const totalPaymentEl = document.getElementById('totalPayment');
            
            if (ticketPriceEl) ticketPriceEl.textContent = ticketPrice.toLocaleString('vi-VN') + '₫';
            if (serviceFeeEl) serviceFeeEl.textContent = serviceFee.toLocaleString('vi-VN') + '₫';
            if (paymentFeeEl) paymentFeeEl.textContent = paymentFee.toLocaleString('vi-VN') + '₫';
            if (totalPaymentEl) totalPaymentEl.textContent = totalPayment.toLocaleString('vi-VN') + '₫';
        }

        // TẠO MÃ GIAO DỊCH
        function updateTransactionCode() {
            const code = 'TRV' + Math.floor(100000 + Math.random() * 900000);
            const transactionCodeEl = document.getElementById('transactionCode');
            const bookingCodeDisplayEl = document.getElementById('bookingCodeDisplay');
            const customerPhoneDisplayEl = document.getElementById('customerPhoneDisplay');
            
            if (transactionCodeEl) transactionCodeEl.textContent = code;
            if (bookingCodeDisplayEl) bookingCodeDisplayEl.textContent = bookingData.flightCode || 'BB123';
            if (customerPhoneDisplayEl) customerPhoneDisplayEl.textContent = bookingData.phone || '0912345678';
        }

        // ĐỊNH DẠNG SỐ THẺ
        function formatCardNumber(value) {
            return value.replace(/\D/g, '').replace(/(\d{4})(?=\d)/g, '$1 ').substring(0, 19);
        }

        // ĐỊNH DẠNG NGÀY HẾT HẠN
        function formatExpiryDate(value) {
            let v = value.replace(/\D/g, '').substring(0, 4);
            if (v.length >= 2) {
                return v.substring(0, 2) + '/' + v.substring(2, 4);
            }
            return v;
        }

        // SỰ KIỆN KHI TRANG LOAD
        document.addEventListener('DOMContentLoaded', function() {
            // Thêm FontAwesome
            if (!document.querySelector('link[href*="font-awesome"]')) {
                const faLink = document.createElement('link');
                faLink.rel = 'stylesheet';
                faLink.href = 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css';
                document.head.appendChild(faLink);
            }

            // Đặt ngày mặc định
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            const departureDateEl = document.getElementById('departureDate');
            if (departureDateEl) {
                departureDateEl.valueAsDate = tomorrow;
                departureDateEl.min = new Date().toISOString().split('T')[0];
            }

            // Khởi tạo ở bước 1
            goToStep(1);

            // VALIDATION REALTIME
            // First name
            const firstNameEl = document.getElementById('firstName');
            if (firstNameEl) {
                firstNameEl.addEventListener('input', function() {
                    if (validateName(this.value)) {
                        showValid('firstName', 'firstNameError', 'firstNameIcon');
                    } else {
                        showError('firstName', 'firstNameError', 'firstNameIcon', 'Vui lòng nhập họ và tên đệm');
                    }
                });
            }

            // Last name
            const lastNameEl = document.getElementById('lastName');
            if (lastNameEl) {
                lastNameEl.addEventListener('input', function() {
                    if (validateName(this.value)) {
                        showValid('lastName', 'lastNameError', 'lastNameIcon');
                    } else {
                        showError('lastName', 'lastNameError', 'lastNameIcon', 'Vui lòng nhập tên');
                    }
                });
            }

            // Email
            const emailEl = document.getElementById('email');
            if (emailEl) {
                emailEl.addEventListener('input', function() {
                    if (validateEmail(this.value)) {
                        showValid('email', 'emailError', 'emailIcon');
                    } else {
                        showError('email', 'emailError', 'emailIcon', 'Vui lòng nhập email hợp lệ (ví dụ: name@example.com)');
                    }
                });
            }

            // Phone
            const phoneEl = document.getElementById('phone');
            if (phoneEl) {
                phoneEl.addEventListener('input', function() {
                    let value = this.value.replace(/\D/g, '');
                    
                    if (value.length <= 4) {
                        this.value = value;
                    } else if (value.length <= 7) {
                        this.value = value.replace(/(\d{4})(\d{0,3})/, '$1 $2');
                    } else if (value.length <= 10) {
                        this.value = value.replace(/(\d{4})(\d{3})(\d{0,3})/, '$1 $2 $3');
                    } else {
                        this.value = value.replace(/(\d{4})(\d{3})(\d{4})/, '$1 $2 $3');
                    }
                    
                    if (validatePhone(this.value)) {
                        showValid('phone', 'phoneError', 'phoneIcon');
                    } else {
                        showError('phone', 'phoneError', 'phoneIcon', 'Vui lòng nhập số điện thoại hợp lệ (10-11 chữ số)');
                    }
                });
            }

            // Card number
            const cardNumberEl = document.getElementById('cardNumber');
            if (cardNumberEl) {
                cardNumberEl.addEventListener('input', function() {
                    this.value = formatCardNumber(this.value);
                    const cardLastFourEl = document.getElementById('cardLastFour');
                    if (cardLastFourEl) {
                        const cleanNumber = this.value.replace(/\s/g, '');
                        cardLastFourEl.textContent = cleanNumber.slice(-4) || '1234';
                    }
                    
                    if (validateCardNumber(this.value)) {
                        showValid('cardNumber', 'cardNumberError', null);
                    } else {
                        showError('cardNumber', 'cardNumberError', null, 'Vui lòng nhập số thẻ hợp lệ (16 chữ số)');
                    }
                });
            }

            // Card holder
            const cardHolderEl = document.getElementById('cardHolder');
            if (cardHolderEl) {
                cardHolderEl.addEventListener('input', function() {
                    const cardHolderNameEl = document.getElementById('cardHolderName');
                    if (cardHolderNameEl) {
                        cardHolderNameEl.textContent = this.value.toUpperCase() || 'NGUYEN VAN A';
                    }
                    
                    if (validateName(this.value)) {
                        showValid('cardHolder', 'cardHolderError', null);
                    } else {
                        showError('cardHolder', 'cardHolderError', null, 'Vui lòng nhập tên chủ thẻ');
                    }
                });
            }

            // Card expiry
            const cardExpiryEl = document.getElementById('cardExpiryDate');
            if (cardExpiryEl) {
                cardExpiryEl.addEventListener('input', function() {
                    this.value = formatExpiryDate(this.value);
                    const cardExpiryDisplayEl = document.getElementById('cardExpiry');
                    if (cardExpiryDisplayEl) {
                        cardExpiryDisplayEl.textContent = this.value || '12/26';
                    }
                    
                    if (validateCardExpiry(this.value)) {
                        showValid('cardExpiryDate', 'cardExpiryError', null);
                    } else {
                        showError('cardExpiryDate', 'cardExpiryError', null, 'Vui lòng nhập ngày hết hạn (MM/YY)');
                    }
                });
            }

            // Card CVV
            const cardCVVEl = document.getElementById('cardCVV');
            if (cardCVVEl) {
                cardCVVEl.addEventListener('input', function() {
                    if (validateCVV(this.value)) {
                        showValid('cardCVV', 'cardCVVError', null);
                    } else {
                        showError('cardCVV', 'cardCVVError', null, 'Vui lòng nhập mã CVV (3 chữ số)');
                    }
                });
            }

            // TÌM CHUYẾN BAY
            const searchFlightsBtn = document.getElementById('searchFlights');
            if (searchFlightsBtn) {
                searchFlightsBtn.addEventListener('click', function() {
                    const departureEl = document.getElementById('departure');
                    const arrivalEl = document.getElementById('arrival');
                    const departureDateEl = document.getElementById('departureDate');
                    const passengersEl = document.getElementById('passengers');
                    
                    if (departureEl && arrivalEl && departureDateEl && passengersEl) {
                        bookingData.departure = departureEl.value;
                        bookingData.arrival = arrivalEl.value;
                        bookingData.departureDate = departureDateEl.value;
                        bookingData.passengers = parseInt(passengersEl.value);
                        
                        alert(`Đang tìm chuyến bay từ ${bookingData.departure} đến ${bookingData.arrival} ngày ${bookingData.departureDate}`);
                        
                        selectedFlight = null;
                        updateStep1Buttons();
                    }
                });
            }

            // CHỌN CHUYẾN BAY
            document.querySelectorAll('.select-flight-btn').forEach(button => {
                button.addEventListener('click', function() {
                    document.querySelectorAll('.flight-card').forEach(card => {
                        card.style.borderColor = '#ddd';
                        card.style.boxShadow = 'none';
                    });
                    
                    const card = this.closest('.flight-card');
                    if (card) {
                        card.style.borderColor = '#ff9800';
                        card.style.boxShadow = '0 5px 15px rgba(255, 152, 0, 0.2)';
                    }
                    
                    selectedFlight = this.getAttribute('data-flight');
                    bookingData.flightCode = selectedFlight;
                    
                    const priceText = card.querySelector('.flight-price').textContent;
                    bookingData.price = parseInt(priceText.replace(/[^\d]/g, ''));
                    
                    updateStep1Buttons();
                });
            });

            // CHỌN PHƯƠNG THỨC THANH TOÁN
            document.querySelectorAll('.payment-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.payment-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    
                    this.classList.add('selected');
                    selectedPaymentMethod = this.getAttribute('data-method');
                    bookingData.paymentMethod = selectedPaymentMethod;
                    
                    // Hiển thị/ẩn form thẻ tín dụng
                    const creditCardForm = document.getElementById('creditCardForm');
                    if (creditCardForm) {
                        if (selectedPaymentMethod === 'visa') {
                            creditCardForm.classList.add('active');
                        } else {
                            creditCardForm.classList.remove('active');
                        }
                    }
                    
                    updatePaymentInfo();
                });
            });

            // Chọn QR code mặc định
            const paymentQREl = document.getElementById('paymentQR');
            if (paymentQREl) {
                paymentQREl.classList.add('selected');
            }
        });

        // SỰ KIỆN ĐIỀU HƯỚNG
        // Bước 1 -> 2
        const nextToStep2Btn = document.getElementById('nextToStep2');
        if (nextToStep2Btn) {
            nextToStep2Btn.addEventListener('click', function() {
                if (selectedFlight) {
                    goToStep(2);
                }
            });
        }

        // Bước 2 -> 3
        const nextToStep3Btn = document.getElementById('nextToStep3');
        if (nextToStep3Btn) {
            nextToStep3Btn.addEventListener('click', function() {
                // Lấy giá trị
                const firstNameEl = document.getElementById('firstName');
                const lastNameEl = document.getElementById('lastName');
                const emailEl = document.getElementById('email');
                const phoneEl = document.getElementById('phone');
                const flightClassEl = document.getElementById('flightClass');
                
                if (!firstNameEl || !lastNameEl || !emailEl || !phoneEl || !flightClassEl) return;
                
                const firstName = firstNameEl.value;
                const lastName = lastNameEl.value;
                const email = emailEl.value;
                const phone = phoneEl.value;
                const flightClass = flightClassEl.value;
                
                // Kiểm tra validation
                let isValid = true;
                
                if (!validateName(firstName)) {
                    showError('firstName', 'firstNameError', 'firstNameIcon', 'Vui lòng nhập họ và tên đệm');
                    isValid = false;
                }
                
                if (!validateName(lastName)) {
                    showError('lastName', 'lastNameError', 'lastNameIcon', 'Vui lòng nhập tên');
                    isValid = false;
                }
                
                if (!validateEmail(email)) {
                    showError('email', 'emailError', 'emailIcon', 'Vui lòng nhập email hợp lệ');
                    isValid = false;
                }
                
                if (!validatePhone(phone)) {
                    showError('phone', 'phoneError', 'phoneIcon', 'Vui lòng nhập số điện thoại hợp lệ');
                    isValid = false;
                }
                
                if (!isValid) {
                    alert('Vui lòng kiểm tra lại thông tin. Có lỗi trong form!');
                    return;
                }
                
                // Lưu thông tin
                bookingData.firstName = firstName.trim();
                bookingData.lastName = lastName.trim();
                bookingData.email = email.trim();
                bookingData.phone = phone.trim();
                bookingData.flightClass = flightClass;
                bookingData.fullName = `${bookingData.firstName} ${bookingData.lastName}`;
                
                // Format số điện thoại
                bookingData.phone = bookingData.phone.replace(/\D/g, '');
                if (bookingData.phone.startsWith('84')) {
                    bookingData.phone = '0' + bookingData.phone.substring(2);
                }
                
                // Cập nhật thông tin xác nhận
                updateConfirmation();
                
                // Chuyển sang bước 3
                goToStep(3);
            });
        }

        // CẬP NHẬT THÔNG TIN XÁC NHẬN
        function updateConfirmation() {
            // Định dạng ngày
            const dateObj = new Date(bookingData.departureDate);
            const formattedDate = dateObj.toLocaleDateString('vi-VN');
            
            // Cập nhật DOM
            const confirmRouteEl = document.getElementById('confirmRoute');
            const confirmDateEl = document.getElementById('confirmDate');
            const confirmPassengersEl = document.getElementById('confirmPassengers');
            const confirmClassEl = document.getElementById('confirmClass');
            const confirmNameEl = document.getElementById('confirmName');
            const confirmEmailEl = document.getElementById('confirmEmail');
            const confirmPhoneEl = document.getElementById('confirmPhone');
            const confirmFlightCodeEl = document.getElementById('confirmFlightCode');
            const confirmPriceEl = document.getElementById('confirmPrice');
            
            if (confirmRouteEl) confirmRouteEl.textContent = `${bookingData.departure} → ${bookingData.arrival}`;
            if (confirmDateEl) confirmDateEl.textContent = formattedDate;
            if (confirmPassengersEl) confirmPassengersEl.textContent = `${bookingData.passengers} hành khách`;
            if (confirmClassEl) {
                confirmClassEl.textContent = 
                    bookingData.flightClass === 'business' ? 'Hạng Thương Gia' : 
                    bookingData.flightClass === 'first' ? 'Hạng Nhất' : 'Hạng Phổ Thông';
            }
            if (confirmNameEl) confirmNameEl.textContent = bookingData.fullName;
            if (confirmEmailEl) confirmEmailEl.textContent = bookingData.email;
            if (confirmPhoneEl) confirmPhoneEl.textContent = bookingData.phone;
            if (confirmFlightCodeEl) confirmFlightCodeEl.textContent = bookingData.flightCode;
            if (confirmPriceEl) confirmPriceEl.textContent = (bookingData.price || 0).toLocaleString('vi-VN') + '₫';
        }

        // BACK BUTTONS
        const backToStep1Btn = document.getElementById('backToStep1');
        if (backToStep1Btn) {
            backToStep1Btn.addEventListener('click', function() {
                goToStep(1);
            });
        }

        const backToStep2Btn = document.getElementById('backToStep2');
        if (backToStep2Btn) {
            backToStep2Btn.addEventListener('click', function() {
                goToStep(2);
            });
        }

        // XÁC NHẬN ĐẶT VÉ
        const confirmBookingBtn = document.getElementById('confirmBooking');
        if (confirmBookingBtn) {
            confirmBookingBtn.addEventListener('click', function() {
                // Kiểm tra phương thức thanh toán thẻ
                if (selectedPaymentMethod === 'visa') {
                    const cardNumberEl = document.getElementById('cardNumber');
                    const cardHolderEl = document.getElementById('cardHolder');
                    const cardExpiryDateEl = document.getElementById('cardExpiryDate');
                    const cardCVVEl = document.getElementById('cardCVV');
                    
                    if (!cardNumberEl || !cardHolderEl || !cardExpiryDateEl || !cardCVVEl) return;
                    
                    let isValid = true;
                    
                    if (!validateCardNumber(cardNumberEl.value)) {
                        showError('cardNumber', 'cardNumberError', null, 'Vui lòng nhập số thẻ hợp lệ');
                        isValid = false;
                    }
                    
                    if (!validateName(cardHolderEl.value)) {
                        showError('cardHolder', 'cardHolderError', null, 'Vui lòng nhập tên chủ thẻ');
                        isValid = false;
                    }
                    
                    if (!validateCardExpiry(cardExpiryDateEl.value)) {
                        showError('cardExpiryDate', 'cardExpiryError', null, 'Vui lòng nhập ngày hết hạn hợp lệ');
                        isValid = false;
                    }
                    
                    if (!validateCVV(cardCVVEl.value)) {
                        showError('cardCVV', 'cardCVVError', null, 'Vui lòng nhập mã CVV hợp lệ');
                        isValid = false;
                    }
                    
                    if (!isValid) {
                        alert('Vui lòng kiểm tra lại thông tin thẻ thanh toán!');
                        return;
                    }
                    
                    // Lưu thông tin thẻ
                    bookingData.cardInfo = {
                        lastFour: cardNumberEl.value.replace(/\s/g, '').slice(-4),
                        holder: cardHolderEl.value,
                        expiry: cardExpiryDateEl.value
                    };
                }
                
                // Lưu vào localStorage
                const completeBookingData = {
                    ...bookingData,
                    flightDate: bookingData.departureDate,
                    terminal: 'Ga Quốc tế - Sân bay Tân Sơn Nhất',
                    flightNumber: bookingData.flightCode,
                    departure: '09:05',
                    boarding: '08:20',
                    bookingTime: new Date().toISOString(),
                    transactionId: 'TRV' + Math.floor(100000 + Math.random() * 900000),
                    paymentMethod: selectedPaymentMethod,
                    totalAmount: bookingData.price + Math.round(bookingData.price * 0.02) + 
                                (selectedPaymentMethod === 'visa' ? Math.round(bookingData.price * 0.015) : 0)
                };
                
                localStorage.setItem('flightBooking', JSON.stringify(completeBookingData));
                
                // Hiển thị thông báo thành công
                const paymentMethods = {
                    'qr': 'QR Code',
                    'visa': 'Thẻ Visa/MasterCard',
                    'momo': 'Ví MoMo',
                    'bank': 'Chuyển khoản ngân hàng'
                };
                
                alert(`🎉 Đặt vé thành công!\n\n` +
                      `Mã đặt chỗ: ${bookingData.flightCode}\n` +
                      `Phương thức thanh toán: ${paymentMethods[selectedPaymentMethod]}\n` +
                      `Tổng thanh toán: ${completeBookingData.totalAmount.toLocaleString('vi-VN')}₫\n` +
                      `Thông tin vé đã được gửi đến ${bookingData.email}\n\n` +
                      `Vui lòng kiểm tra email để nhận e-ticket và thông tin chi tiết.`);
                
                // Chuyển hướng đến trang e-ticket
                setTimeout(() => {
                    window.location.href = 'e-ticket.html';
                }, 2000);
            });
        }

        // QUAY LẠI TRANG CHỦ
        const backToHomeBtn = document.getElementById('backToHome');
        if (backToHomeBtn) {
            backToHomeBtn.addEventListener('click', function(e) {
                e.preventDefault();
                if (currentStep > 1 && !confirm('Bạn có chắc muốn quay lại trang chủ? Thông tin chưa lưu sẽ bị mất.')) {
                    return;
                }
                window.location.href = 'index.html';
            });
        }
    </script>
</body>
</html>